cd /tmp

DATABASE=$1
USER=$2
PASSWORD=$3

output=`sudo -u postgres psql postgres -tAc "SELECT 1 FROM pg_roles WHERE rolname='$USER'" 2> /dev/null`

if [ "$output" != 1 ]
then
	output=`sudo -u postgres psql postgres -tAc "CREATE USER $USER WITH PASSWORD '$PASSWORD';" 2> /dev/null`
else
	echo "User '$USER' exists already."
fi

output=`sudo -u postgres psql -lqt | cut -d \| -f 1 | grep -w $DATABASE`
if [ $output != ""]
then
    output=`sudo -u postgres psql postgres -tAc "ALTER USER "$USER" CREATEDB;"`
    output=`sudo -u postgres psql postgres -tAc "CREATE DATABASE $DATABASE;"`
    output=`sudo -u postgres psql postgres -tAc "GRANT ALL PRIVILEGES ON DATABASE $DATABASE TO $USER;"`
    
else
   echo "database ${DATABASE} exists"
fi

